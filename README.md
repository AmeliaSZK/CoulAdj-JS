# Colour Adjacencies
Reads an image and outputs the colour adjacencies in a TSV file.
Primary objective is to help me learn C++ and Qt. 
Intended to be used on Windows with a pretty GUI.

This project declares conformity to [SemVer 2.0.0](https://semver.org/spec/v2.0.0.html).

"Colour" and "color" will be used interchangeably and arbitrarily in both the code
and documentation.

This project is still in development.

# Compilation
There are 3 possible build processes: Quick Linux, Canonical Linux, and Windows.
Canonical Linux and Windows rely on the Qt Creator IDE, and are all that a beginner
should need to compile *once the project is made public*. **Quick Linux is 
intended for people who just want to check out the source code and quickly compile.** 
It is mostly intended for friends to whom I gave access to the private
repository.

I am personally doing most of the development outside of Qt Creator. A notable
exception is GUI design and editing. Efforts have been made to ensure that you
and I could clone and build from the command line like normal people, but GUI
development was left to Qt Creator.

## Quick Build on Linux
**Qt Version: 5.9.5**

The official way to obtain Qt is to download the online installer, select the
appropriate components to download, and also download Qt Creator at the same time
because you cannot deselect it in the installer. The result is a minimum
of 1.7 GB installation size on your computer, and a download of about 550 MB. This
is obviously too much for someone who just wants to check out the source code and
compile it.

### Requirements
*   g++
*   Make
*   Qt5
*   qmake

On Ubuntu, you can acquire the last two items with:
```bash
sudo apt install qt5-default qt5-qmake
```
These two *should* be enough, but I have not yet been able to test this on a
machine with no prior traces of Qt. If you aren't on Ubuntu, I unfortunately
cannot help you more than this. 

### Compilation
1. After cloning, and once you are at the root of the repository in a terminal, 
do `qmake`. This command will (should?) generate everything you need to compile. 
1. Then you can build it all with `make`.
1. After making changes in the source code, you can build again with `make`.
1. If you create new files that need to be included in the build process, you
need to signal this in the `colour-adjacencies.pro` file.

#### Example
First time cloning and compilation:
```bash
$ mkdir ~/Documents/colour-adjacencies
$ cd ~/Documents/colour-adjacencies
$ git clone https://github.com/AmeliaSZK/colour-adjacencies.git
$ cd colour-adjacencies/
$ qmake
$ make
$ ./colour-adjacencies --hi
Hello friend :D !
```
The relevant section of `colour-adjacencies.pro` before you make changes:
```
SOURCES += \
    main.cpp \
    mainwindow.cpp

HEADERS += \
    mainwindow.h
```
How this section should look like after you've created `mainconsole.cpp` and
`mainconsole.h`:
```
SOURCES += \
    main.cpp \
    mainconsole.cpp \
    mainwindow.cpp

HEADERS += \
    mainconsole.h \
    mainwindow.h
```
Compiling after your changes:
```bash
$ make
```

#### Additional notes

*   When you call `make`, the makefile previously generated by `qmake` will re-write itself to include the changes in the `.pro` file. Which is why you don't need to
call `qmake` more than once.
*   Yes, I know that this build is using Qt 5.9.5 instead of the 5.15.0 like the
other two build processes. The Ubuntu package manager gives you 5.9.5, and the
official documentation website sends you to 5.15.0 by default. I decided to
align the canon with the default documentation.




## Canonical Build on Linux
**Qt Version: 5.15.0**

### Installing Qt Creator
Download the [official installer](https://www.qt.io/download-qt-installer).

The only optional components you should need from the installer are 
`Desktop gcc 64-bit` and `Qt Installer Framework 3.2`.

![Selection of the components in the installer.](canonical-linux.png "Qt Creator components on Linux")

To be completed.

## Windows Build
**Qt Version: 5.15.0**

You should be selecting the MinGW package for Qt 5.15.0

To be completed.

## Tests
These tests are intended for developpers, not for end-users.

### Linux
All commands should be launched from the root of the repository.

#### Correctness
```bash
bash test-corr
```
Will process the four samples, and compare their results with their golden (expected)
results. Will signal samples that returned incorrect results, otherwise silent.

##### Good
```bash
$ bash test-corr
$
```

##### Bad
```bash
$ bash test-corr
Warhammer failed
Wh2 failed
$
```
Those samples are big (50+ MB) and proprietary, so they're not included in this
repository. If you do not have those file, failing those tests is normal.

##### Worse
```bash
$ bash test-corr
Small failed
Small Alpha failed
$
```
You might have issues with the diagonals. 
The small samples have colours that are adjacent only by pixel(s) in diagonal. 
This is *not* the case for the big samples.

##### Worst
```bash
$ bash test-corr
Small failed
Small Alpha failed
Warhammer failed
Wh2 failed
$
```
If all results appear correct, check the line endings.


# Intended Final API

## Input
*   Options
    * Don't relate diagonals
        * For each pixel, only consider as adjacent the four (4) neighbours with
        a common edge. (top, bottom, left, and right neighbours)
    * Always include alpha column in output
        * If the image doesn't have an alpha component, one will be added at
        full opacity in the output.
*   Filepath to source image file
*   Filepath to where to write the results

### Command Line Interface

*   Can be called from the command line with 0 to 4 arguments.
*   If 0 arguments, will launch a graphical user interface.
*   If 1 argument and it is one of `-h`, `-?`, or `--help`, will display a help message.
*   If 1 argument and it is one of `-v` or `--version`, will display version and copyright informations.
*   In all other cases:
    - **Second-to-last** argument must be filepath to **source** image.
    - **Last** argument must be filepath to **destination** file.
*   The optional arguments are:
    - `--dont-relate-diagonals`
    - `--always-include-alpha`

Examples of valid calls:

```bash
./colour-adjacencies --help
```
```bash
./colour-adjacencies --version
```
```bash
$ ./colour-adjacencies "path/to/source.bmp" "path/to/destination.tsv"
```
```bash
$ ./colour-adjacencies --dont-relate-diagonals "path/to/source.bmp" "path/to/destination.tsv"
```
```bash
$ ./colour-adjacencies --always-include-alpha "path/to/source.bmp" "path/to/destination.tsv"
```
```bash
$ ./colour-adjacencies --always-include-alpha --dont-relate-diagonals "path/to/source.bmp" "path/to/destination.tsv"
```

## Output
*   A tab-separated values (`.tsv`) file.
*   For images **with** an alpha channel, data will be formatted like this:

    |r  |g  |b  |a  |adj_r|adj_g|adj_b|adj_a|
    |---|---|---|---|-----|-----|-----|-----|
    |0  |32 |64 |128|0    |0    |0    |255  |
    |0  |32 |64 |255|0    |0    |0    |255  |
    |0  |32 |64 |255|0    |32   |0    |255  |
    |0  |64 |0  |255|0    |0    |0    |255  |

*   By default, for images **without** an alpha channel, the alpha columns will be absent.

    |r  |g  |b  |adj_r|adj_g|adj_b|
    |---|---|---|-----|-----|-----|
    |0  |32 |64 |0    |0    |0    |
    |0  |32 |64 |0    |32   |0    |
    |0  |64 |0  |0    |0    |0    |

*   If `dont-relate-diagonals` was specified, images **without** an alpha channel
will get an alpha column at full opacity.

    |r  |g  |b  |a  |adj_r|adj_g|adj_b|adj_a|
    |---|---|---|---|-----|-----|-----|-----|
    |0  |32 |64 |255|0    |0    |0    |255  |
    |0  |32 |64 |255|0    |32   |0    |255  |
    |0  |64 |0  |255|0    |0    |0    |255  |


*   The rows will be sorted in ascending order.

    |r  |g  |b  |adj_r|adj_g|adj_b|
    |---|---|---|-----|-----|-----|
    |0  |32 |64 |0    |0    |0    |
    |0  |32 |64 |0    |32   |0    |
    |0  |64 |0  |0    |0    |0    |

*   Symmetric relations will be included;
if A is adjacent to B, then B is adjacent to A, 
so this single relation will generate two rows.

    |r  |g  |b  |adj_r|adj_g|adj_b|
    |---|---|---|-----|-----|-----|
    |0  |0  |0  |0    |64   |0    |
    |0  |64 |0  |0    |0    |0    |

*   Reflexive relations will *not* be included;
a color cannot be adjacent with itself.

*   Columns will be sorted in this order:
    - Red
    - Green
    - Blue
    - Alpha (if applicable)
    - Adjacent Red
    - Adjacent Green
    - Adjacent Blue
    - Adjacent Alpha (if applicable)

*   The first row will contain the column names.
*   The column names will be:

    |Column Name|Color Channel  | Note           |
    |-----------|---------------|----------------|
    | `r`       |Red            |
    | `g`       |Green          |
    | `b`       |Blue           |
    | `a`       |Alpha          |(if applicable) |
    | `adj_r`   |Adjacent Red   |
    | `adj_g`   |Adjacent Green |
    | `adj_b`   |Adjacent Blue  |
    | `adj_a`   |Adjacent Alpha |(if applicable) |

*   The line-endings may be either in Windows (CRLF) or Unix (LF) style.